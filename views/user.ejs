<!doctype html>
<%- include("head"); %>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" />
<body id="page">
  <nav>
    <h1 id="name"><%=user.name%> Profile</h1>
  </nav>
  <article id="userprofile">
    <section class="profile-header">
      <% if (user.gravatar) { %>
      <a href="https://gravatar.com" target="_blank" rel="noopener noreferrer"
         title="Go to gravatar.com to register and upload your avatar">
        <img id="avatar" src="<%=user.gravatar%>" alt="<%=user.name%> avatar">
      </a>
      <% } else { %>
      <span id="avatar" class="i-white" aria-hidden="true"
        title="Go to gravatar.com to register and upload your avatar"></span>
      <% } %>
      <div class="profile-meta">
        <h2><%=user.name%></h2>
        <% if (user.role === "mod") { %>
        <p class="role-chip">Moderator</p>
        <% } %>
        <% if (info.email) { %>
        <p class="muted">
          Reachable at
          <a href="mailto:<%=user.email%>"><%=user.email%></a>
        </p>
        <% } %>
      </div>
    </section>

    <section class="profile-stats">
      <div class="stat-card">
        <h3>Total Uploaded</h3>
        <p><%=info.uploaded || "0 B"%></p>
        <% if (info.uploadedRank) { %>
        <small><a href="/top/uploaded"><%=info.uploadedRank%></a> globally</small>
        <% } %>
      </div>
      <div class="stat-card">
        <h3>Total Downloaded</h3>
        <p><%=info.downloaded || "0 B"%></p>
        <% if (info.downloadedRank) { %>
        <small><%=info.downloadedRank%> globally</small>
        <% } %>
      </div>
      <div class="stat-card">
        <h3>Files Uploaded</h3>
        <p><%=info.files || "0"%></p>
        <% if (info.filesRank) { %>
        <small><a href="/top/files"><%=info.filesRank%></a> globally</small>
        <% } %>
      </div>
      <div class="stat-card">
        <h3>Achievements</h3>
        <p><%=info.achievements.unlocked%> / <%=info.achievements.total%></p>
        <small>Unlocked milestones</small>
      </div>
    </section>

    <div class="profile-tabbed">
    <nav class="profile-tabs" role="tablist" aria-label="Profile sections">
      <button class="profile-tab active" data-tab="overview" role="tab" aria-selected="true">Overview</button>
      <button class="profile-tab" data-tab="achievements" role="tab" aria-selected="false">
        Achievements
        <span class="tab-badge"><%=info.achievements.unlocked%> / <%=info.achievements.total%></span>
      </button>
    </nav>

    <section class="profile-message">
      <% if (info.canEditMessage) { %>
      <form id="profile-message-form" action="javascript:">
        <input type="hidden" id="profile-token" value="<%=token%>">
        <div class="profile-message-fields">
          <div class="profile-message-field">
            <label for="profile-about-input">About Me</label>
            <textarea
              id="profile-about-input"
              name="message"
              maxlength="2000"
              placeholder="Tell visitors about yourselfâ€¦"><%=user.message || ""%></textarea>
          </div>
          <div class="profile-message-field profile-message-field--looking">
            <label for="profile-looking-input">What I'm Looking For</label>
            <textarea
              id="profile-looking-input"
              name="looking"
              maxlength="2000"
              placeholder="What kind of files or collaborations are you looking for?"><%=user.looking || ""%></textarea>
          </div>
        </div>
        <div class="form-actions">
          <span id="profile-message-status" class="muted"></span>
          <button id="profile-message-save" type="submit">Save</button>
        </div>
      </form>
      <% } %>
      <% if (info.messageHtml || info.lookingHtml) { %>
      <div class="profile-message-view">
        <% if (info.messageHtml) { %>
        <div class="profile-message-block">
          <h4>About Me</h4>
          <div class="profile-message-rendered"><%- info.messageHtml %></div>
        </div>
        <% } %>
        <% if (info.lookingHtml) { %>
        <div class="profile-message-block">
          <h4>What I'm Looking For</h4>
          <div class="profile-message-rendered"><%- info.lookingHtml %></div>
        </div>
        <% } %>
      </div>
      <% } %>
    </section>

    <section class="profile-achievements">
      <h3>Achievements</h3>
      <div class="achievement-grid">
        <% for (const a of info.achievements.all) { %>
        <article class="achievement <%=a.unlocked ? "unlocked" : "locked"%> rarity-<%=a.rarity%>" title="<%=a.description%>">
          <span class="achievement-icon" aria-hidden="true"><i class="<%=a.icon%>"></i></span>
          <h4><%=a.title%></h4>
          <p><%=a.description%></p>
          <% if (!a.unlocked) { %>
          <div class="achievement-progress">
            <div class="achievement-progress-bar" style="width:<%=Math.min(100, Math.round(a.current / a.required * 100))%>%"></div>
          </div>
          <% } %>
          <small><%=a.unlocked ? "Unlocked" : Math.round(a.current / a.required * 100) + "% complete"%></small>
        </article>
        <% } %>
      </div>
    </section>
    </div><!-- /profile-tabbed -->
  </article>
  <script src="/user.js?v=<%=v%>"></script>
  <%- include("footer"); %>
</body>
