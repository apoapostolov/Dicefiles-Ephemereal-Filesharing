{"version":3,"file":"archivemodal.js?v=80a5b0a72bf110b50b7f","mappings":"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","sources":["webpack:///../client/files/archivemodal.js"],"sourcesContent":["\"use strict\";\n\n/**\n * Archive viewer modal.\n *\n * Opens when the user clicks on an archive file (.zip, .rar, .7z, .001, etc.).\n * Shows a two-panel layout:\n *   Left  — folder tree with checkboxes (select folder → selects all its files)\n *   Right — flat file list for selected folders, with per-file checkboxes\n *\n * \"Download Selected\" opens the existing DownloadBatchModal with synthetic\n * file objects that point to /api/v1/archive/:key/file?path=<encoded-path>.\n */\n\nimport Modal from \"../modal\";\nimport registry from \"../registry\";\nimport { dom, nukeEvent, toPrettySize } from \"../util\";\nimport DownloadBatchModal from \"./downloadmodal\";\n\n// Extensions that can be inline-previewed on hover\nconst IMAGE_EXTS = new Set([\n  \".jpg\",\n  \".jpeg\",\n  \".png\",\n  \".gif\",\n  \".webp\",\n  \".bmp\",\n  \".avif\",\n  \".svg\",\n]);\n\nfunction isImageEntry(filePath) {\n  const dot = filePath.lastIndexOf(\".\");\n  return dot >= 0 && IMAGE_EXTS.has(filePath.slice(dot).toLowerCase());\n}\n\n// ── Folder-tree helpers ───────────────────────────────────────────────────────\n\n/**\n * Build a tree from a flat listing.\n * Each node: { name, fullPath, children: Map<string, node>, files: entry[] }\n */\nfunction buildTree(files) {\n  const root = { name: \"\", fullPath: \"\", children: new Map(), files: [] };\n\n  for (const entry of files) {\n    if (entry.isDir) {\n      continue; // derive dirs from file paths\n    }\n    const parts = entry.path.split(\"/\");\n    let node = root;\n    for (let i = 0; i < parts.length - 1; i++) {\n      const part = parts[i];\n      if (!part) {\n        continue;\n      }\n      if (!node.children.has(part)) {\n        const fullPath = node.fullPath ? `${node.fullPath}/${part}` : part;\n        node.children.set(part, {\n          name: part,\n          fullPath,\n          children: new Map(),\n          files: [],\n        });\n      }\n      node = node.children.get(part);\n    }\n    node.files.push(entry);\n  }\n\n  // Add explicitly listed directories that may have no files\n  for (const entry of files) {\n    if (!entry.isDir) {\n      continue;\n    }\n    const dirPath = entry.path.replace(/\\/$/, \"\");\n    if (!dirPath) {\n      continue;\n    }\n    const parts = dirPath.split(\"/\").filter(Boolean);\n    let node = root;\n    for (const part of parts) {\n      if (!node.children.has(part)) {\n        const fullPath = node.fullPath ? `${node.fullPath}/${part}` : part;\n        node.children.set(part, {\n          name: part,\n          fullPath,\n          children: new Map(),\n          files: [],\n        });\n      }\n      node = node.children.get(part);\n    }\n  }\n\n  return root;\n}\n\n/**\n * Collect all file entries under a tree node (recursively).\n */\nfunction collectFiles(node) {\n  const out = [];\n  for (const f of node.files) {\n    out.push(f);\n  }\n  for (const child of node.children.values()) {\n    out.push(...collectFiles(child));\n  }\n  return out;\n}\n\n// ── ArchiveModal ──────────────────────────────────────────────────────────────\n\nexport default class ArchiveModal extends Modal {\n  /**\n   * @param {object} fileInst — the File instance from client/files/file.js\n   */\n  constructor(fileInst) {\n    const dlBtn = { id: \"download\", text: \"Download Selected\", default: true };\n    const closeBtn = { id: \"close\", text: \"Close\", cancel: true };\n    super(\"archiveviewer\", `Archive: ${fileInst.name}`, dlBtn, closeBtn);\n\n    this.fileInst = fileInst;\n    // Extract the upload key from the file href  (e.g. /g/<key> or /g/<key>/name)\n    const parts = (fileInst.href || \"\").split(\"/\").filter(Boolean);\n    const gi = parts.indexOf(\"g\");\n    this.archiveKey =\n      gi >= 0 ? parts[gi + 1] || null : parts[parts.length - 1] || null;\n\n    this._tree = null; // root tree node after load\n    this._allFiles = []; // flat Array<{path,size,isDir}>\n    this._format = null;\n\n    // UI state\n    this._folderChecked = new Map(); // fullPath → boolean\n    this._fileChecked = new Map(); // entry.path → boolean\n    this._folderExpanded = new Map(); // fullPath → boolean\n\n    // DOM elements built in _buildUI()\n    this._treeEl = null;\n    this._fileListEl = null;\n    this._folderInfoEl = null;\n    this._fileInfoEl = null;\n    this._dlBtn = dlBtn.btn;\n\n    // Set by mountInto()\n    this._holder = null;\n    this._subHolder = null;\n    this._onKeyDown = null;\n\n    // Search filter state\n    this._searchQuery = \"\";\n\n    // Image preview popup (created in _buildUI, shared across all rows)\n    this._imgPopupEl = null;\n    this._imgPopupImgEl = null;\n\n    this._buildUI();\n    this._loadListing();\n  }\n\n  // ── Custom mounting (inside #filelist, not in a global fixed modal-holder) ──\n\n  /**\n   * Mount the archive viewer as an absolute overlay inside `container`.\n   * Returns this.promise (resolves/rejects when the viewer is closed).\n   */\n  mountInto(container) {\n    this._holder = dom(\"div\", { classes: [\"av-holder\"] });\n    this._holder.appendChild(this.el);\n    container.appendChild(this._holder);\n\n    // Escape closes the viewer (only when no sub-modal is open)\n    this._onKeyDown = (e) => {\n      if (e.key !== \"Escape\" || this._subHolder) {\n        return;\n      }\n      e.stopPropagation();\n      this._unmount();\n      this.reject(new Error(\"cancelled\"));\n    };\n    document.addEventListener(\"keydown\", this._onKeyDown, true);\n\n    // Click on the dim backdrop closes the viewer\n    this._holder.addEventListener(\"click\", (e) => {\n      if (e.target === this._holder && !this._subHolder) {\n        this._unmount();\n        this.reject(new Error(\"cancelled\"));\n      }\n    });\n\n    this.onshown();\n    return this.promise;\n  }\n\n  _unmount() {\n    if (this._holder && this._holder.parentElement) {\n      this._holder.parentElement.removeChild(this._holder);\n    }\n    this._holder = null;\n    if (this._onKeyDown) {\n      document.removeEventListener(\"keydown\", this._onKeyDown, true);\n      this._onKeyDown = null;\n    }\n  }\n\n  // ── UI construction ─────────────────────────────────────────────────────────\n\n  _buildUI() {\n    this.el.classList.add(\"modal-archiveviewer\");\n\n    const layout = dom(\"div\", { classes: [\"av-layout\"] });\n\n    // ── Left sidebar ──\n    const sidebar = dom(\"div\", { classes: [\"av-sidebar\"] });\n    const sidebarHead = dom(\"div\", { classes: [\"av-sidebar-header\"] });\n\n    // Root \"/ [all]\" checkbox lives in the header, not the tree\n    this._rootCbEl = dom(\"input\", {\n      attrs: { type: \"checkbox\", title: \"Select / deselect all files\" },\n      classes: [\"av-root-cb\"],\n    });\n    this._rootCbEl.addEventListener(\"change\", () => {\n      this._folderChecked.set(\"\", this._rootCbEl.checked);\n      if (this._tree) {\n        this._setChildFolders(this._tree, this._rootCbEl.checked);\n      }\n      this._syncRootCheckbox();\n      this._updateFolderInfo();\n      this._renderTree();\n      this._renderFiles();\n    });\n\n    const rootLabel = dom(\"span\", {\n      classes: [\"av-root-label\"],\n      text: \"/ [all]\",\n    });\n    rootLabel.addEventListener(\"click\", () => this._rootCbEl.click());\n\n    this._folderInfoEl = dom(\"span\", {\n      classes: [\"av-select-info\"],\n      text: \"\",\n    });\n\n    // Tight expand/collapse group\n    const expandGroup = dom(\"div\", { classes: [\"av-expand-group\"] });\n    const expandAllBtn = dom(\"button\", {\n      classes: [\"av-ctrl-btn\"],\n      attrs: { type: \"button\", title: \"Expand all folders\" },\n      text: \"⊞\",\n    });\n    expandAllBtn.addEventListener(\"click\", () => this._expandAll(true));\n\n    const collapseAllBtn = dom(\"button\", {\n      classes: [\"av-ctrl-btn\"],\n      attrs: { type: \"button\", title: \"Collapse all folders\" },\n      text: \"⊟\",\n    });\n    collapseAllBtn.addEventListener(\"click\", () => this._expandAll(false));\n\n    expandGroup.appendChild(expandAllBtn);\n    expandGroup.appendChild(collapseAllBtn);\n\n    sidebarHead.appendChild(this._rootCbEl);\n    sidebarHead.appendChild(rootLabel);\n    sidebarHead.appendChild(this._folderInfoEl);\n    sidebarHead.appendChild(expandGroup);\n    sidebar.appendChild(sidebarHead);\n\n    this._treeEl = dom(\"div\", { classes: [\"av-tree\"] });\n    sidebar.appendChild(this._treeEl);\n\n    // ── Right file list ──\n    const filePanel = dom(\"div\", { classes: [\"av-filelist\"] });\n    const fileHead = dom(\"div\", { classes: [\"av-filelist-header\"] });\n\n    this._fileInfoEl = dom(\"span\", {\n      classes: [\"av-select-info\"],\n      text: \"\",\n    });\n\n    const selectAllBtn = dom(\"button\", {\n      classes: [\"av-ctrl-btn\"],\n      attrs: { type: \"button\", title: \"Select all visible files\" },\n      text: \"Select all\",\n    });\n    selectAllBtn.addEventListener(\"click\", () => this._selectAllFiles(true));\n\n    const clearSelBtn = dom(\"button\", {\n      classes: [\"av-ctrl-btn\"],\n      attrs: { type: \"button\", title: \"Clear file selection\" },\n      text: \"Clear\",\n    });\n    clearSelBtn.addEventListener(\"click\", () => this._selectAllFiles(false));\n\n    fileHead.appendChild(this._fileInfoEl);\n    fileHead.appendChild(selectAllBtn);\n    fileHead.appendChild(clearSelBtn);\n    filePanel.appendChild(fileHead);\n\n    // Inline file search (below header, visible when tree content loaded)\n    const searchRow = dom(\"div\", { classes: [\"av-search-row\"] });\n    this._searchEl = dom(\"input\", {\n      attrs: {\n        type: \"text\",\n        placeholder: \"Filter files…\",\n        autocomplete: \"off\",\n        spellcheck: \"false\",\n      },\n      classes: [\"av-search\"],\n    });\n    this._searchEl.addEventListener(\"input\", () => {\n      this._searchQuery = this._searchEl.value.trim().toLowerCase();\n      this._renderFiles();\n    });\n    searchRow.appendChild(this._searchEl);\n    filePanel.appendChild(searchRow);\n\n    this._fileListEl = dom(\"div\", { classes: [\"av-files\"] });\n    filePanel.appendChild(this._fileListEl);\n\n    // Shared image preview popup — absolutely positioned within the modal\n    this._imgPopupEl = dom(\"div\", { classes: [\"av-img-popup\"] });\n    this._imgPopupImgEl = dom(\"img\", { attrs: { alt: \"\" } });\n    this._imgPopupEl.appendChild(this._imgPopupImgEl);\n    // Appended to this.el so it overlays the modal; requires position:relative on .modal-archiveviewer\n    this.el.appendChild(this._imgPopupEl);\n\n    layout.appendChild(sidebar);\n    layout.appendChild(filePanel);\n    this.body.appendChild(layout);\n\n    // Status / loading indicator\n    this._statusEl = dom(\"div\", { classes: [\"av-status\"], text: \"Loading…\" });\n    this.body.appendChild(this._statusEl);\n  }\n\n  // ── Data loading ────────────────────────────────────────────────────────────\n\n  async _loadListing() {\n    if (!this.archiveKey) {\n      this._setStatus(\"Could not determine archive key.\");\n      return;\n    }\n    try {\n      const res = await fetch(`/api/v1/archive/${this.archiveKey}/ls`, {\n        credentials: \"same-origin\",\n      });\n      if (!res.ok) {\n        const json = await res.json().catch(() => ({}));\n        throw new Error(json.error || `HTTP ${res.status}`);\n      }\n      const data = await res.json();\n      this._format = data.format || \"?\";\n      this._allFiles = (data.files || []).filter((f) => !f.isDir);\n      this._tree = buildTree(data.files || []);\n      this._setStatus(\"\");\n      this._renderTree();\n      this._renderFiles();\n    } catch (ex) {\n      this._setStatus(`Failed to load archive: ${ex.message}`);\n    }\n  }\n\n  _setStatus(text) {\n    if (this._statusEl) {\n      this._statusEl.textContent = text;\n      this._statusEl.classList.toggle(\"hidden\", !text);\n    }\n  }\n\n  // ── Tree rendering ──────────────────────────────────────────────────────────\n\n  _renderTree() {\n    this._treeEl.textContent = \"\";\n    if (!this._tree) {\n      return;\n    }\n    // Root is in the sidebar header; only render its children here\n    for (const child of this._tree.children.values()) {\n      this._treeEl.appendChild(this._buildTreeNode(child, 0));\n    }\n    this._syncRootCheckbox();\n    this._updateFolderInfo();\n  }\n\n  _buildTreeNode(node, depth) {\n    const frag = document.createDocumentFragment();\n    frag.appendChild(this._makeTreeRow(node, depth));\n    if (!!this._folderExpanded.get(node.fullPath)) {\n      for (const child of node.children.values()) {\n        frag.appendChild(this._buildTreeNode(child, depth + 1));\n      }\n    }\n    return frag;\n  }\n\n  _makeTreeRow(node, depth = 0) {\n    const fullPath = node.fullPath;\n    const isChecked = !!this._folderChecked.get(fullPath);\n    const isExpanded = !!this._folderExpanded.get(fullPath);\n    const hasChildren = node.children.size > 0;\n\n    const row = dom(\"div\", {\n      classes: [\"av-tree-item\", ...(isChecked ? [\"is-checked\"] : [])],\n    });\n    row.style.paddingLeft = `${depth * 14 + 4}px`;\n\n    const cb = dom(\"input\", {\n      attrs: { type: \"checkbox\" },\n      classes: [\"av-tree-cb\"],\n    });\n    cb.checked = isChecked;\n    cb.addEventListener(\"change\", () => {\n      this._setChildFolders(node, cb.checked);\n      row.classList.toggle(\"is-checked\", cb.checked);\n      this._syncRootCheckbox();\n      this._updateFolderInfo();\n      this._renderFiles();\n    });\n\n    const expander = dom(\"button\", {\n      classes: [\n        \"av-tree-expander\",\n        ...(hasChildren ? [] : [\"av-tree-expander-leaf\"]),\n      ],\n      attrs: {\n        type: \"button\",\n        \"aria-label\": isExpanded ? \"Collapse\" : \"Expand\",\n      },\n      text: hasChildren ? (isExpanded ? \"▾\" : \"▸\") : \" \",\n    });\n    expander.addEventListener(\"click\", (e) => {\n      nukeEvent(e);\n      if (!hasChildren) {\n        return;\n      }\n      const nowExpanded = !this._folderExpanded.get(fullPath);\n      this._folderExpanded.set(fullPath, nowExpanded);\n      this._renderTree();\n    });\n\n    const icon = dom(\"span\", { classes: [\"av-tree-icon\", \"i-archive-b\"] });\n    const label = dom(\"span\", {\n      classes: [\"av-tree-name\"],\n      text: node.name,\n    });\n    label.addEventListener(\"click\", () => {\n      cb.click();\n    });\n\n    const count = collectFiles(node).length;\n    const countEl = dom(\"span\", {\n      classes: [\"av-tree-count\"],\n      text: count > 0 ? `${count}` : \"\",\n    });\n\n    row.appendChild(cb);\n    row.appendChild(expander);\n    row.appendChild(icon);\n    row.appendChild(label);\n    row.appendChild(countEl);\n\n    return row;\n  }\n\n  _setChildFolders(node, checked) {\n    this._folderChecked.set(node.fullPath, checked);\n    for (const child of node.children.values()) {\n      this._setChildFolders(child, checked);\n    }\n  }\n\n  /** Sync the header root checkbox to reflect current folder selection state. */\n  _syncRootCheckbox() {\n    if (!this._rootCbEl) {\n      return;\n    }\n    const rootChecked = !!this._folderChecked.get(\"\");\n    this._rootCbEl.checked = rootChecked;\n    this._rootCbEl.indeterminate = false;\n    if (!rootChecked) {\n      for (const [k, v] of this._folderChecked) {\n        if (k !== \"\" && v) {\n          this._rootCbEl.indeterminate = true;\n          break;\n        }\n      }\n    }\n  }\n\n  /**\n   * Build a folder row for the right-hand file list panel.\n   * Mirrors the sidebar tree checkbox so clicking either panel syncs the other.\n   */\n  _makeFilePanelFolderRow(node) {\n    const fullPath = node.fullPath;\n    const isChecked = !!this._folderChecked.get(fullPath);\n    const fileCount = collectFiles(node).length;\n\n    const row = dom(\"div\", {\n      classes: [\n        \"av-file-item\",\n        \"av-file-folder\",\n        ...(isChecked ? [\"is-checked\"] : []),\n      ],\n    });\n\n    const cb = dom(\"input\", {\n      attrs: { type: \"checkbox\" },\n      classes: [\"av-file-cb\"],\n    });\n    cb.checked = isChecked;\n    cb.addEventListener(\"change\", () => {\n      this._setChildFolders(node, cb.checked);\n      this._syncRootCheckbox();\n      this._updateFolderInfo();\n      this._renderTree();\n      this._renderFiles();\n    });\n\n    const nameEl = dom(\"span\", {\n      classes: [\"av-file-name\"],\n      attrs: { title: fullPath },\n    });\n    nameEl.textContent = node.name + \"/\";\n    nameEl.addEventListener(\"click\", () => cb.click());\n\n    const countEl = dom(\"span\", {\n      classes: [\"av-file-size\"],\n      text:\n        fileCount > 0 ? `${fileCount} file${fileCount === 1 ? \"\" : \"s\"}` : \"\",\n    });\n\n    row.appendChild(cb);\n    row.appendChild(nameEl);\n    row.appendChild(countEl);\n    return row;\n  }\n\n  // ── File list rendering ─────────────────────────────────────────────────────\n\n  /**\n   * Return files visible in the right panel: those belonging to any checked\n   * folder, or all files if the root (\"\") is checked.\n   * Also applies the inline search filter if a query is set.\n   */\n  _getVisibleFiles() {\n    if (!this._tree) {\n      return [];\n    }\n    const rootChecked = !!this._folderChecked.get(\"\");\n    let base;\n    if (rootChecked) {\n      base = this._allFiles;\n    } else {\n      // Collect files from all checked folder nodes\n      const result = [];\n      const seen = new Set();\n      const visit = (node) => {\n        if (this._folderChecked.get(node.fullPath)) {\n          for (const f of collectFiles(node)) {\n            if (!seen.has(f.path)) {\n              seen.add(f.path);\n              result.push(f);\n            }\n          }\n          return; // children already included by collectFiles\n        }\n        for (const child of node.children.values()) {\n          visit(child);\n        }\n      };\n      visit(this._tree);\n\n      // If nothing is checked, show all files\n      if (!result.length && !this._hasAnyFolderChecked()) {\n        base = this._allFiles;\n      } else {\n        base = result;\n      }\n    }\n\n    // Apply inline search filter\n    const q = this._searchQuery;\n    if (!q) {\n      return base;\n    }\n    return base.filter((f) => {\n      const name = (f.path.split(\"/\").pop() || f.path).toLowerCase();\n      return name.includes(q) || f.path.toLowerCase().includes(q);\n    });\n  }\n\n  _hasAnyFolderChecked() {\n    for (const v of this._folderChecked.values()) {\n      if (v) return true;\n    }\n    return false;\n  }\n\n  _renderFiles() {\n    this._fileListEl.textContent = \"\";\n\n    // Subfolder rows at the top (root's direct children)\n    if (this._tree && this._tree.children.size > 0) {\n      for (const child of this._tree.children.values()) {\n        this._fileListEl.appendChild(this._makeFilePanelFolderRow(child));\n      }\n    }\n\n    const files = this._getVisibleFiles();\n\n    if (!files.length) {\n      if (!this._tree || this._tree.children.size === 0) {\n        const empty = dom(\"div\", {\n          classes: [\"av-files-empty\"],\n          text: this._tree ? \"No files in selection.\" : \"Loading…\",\n        });\n        this._fileListEl.appendChild(empty);\n      }\n      this._updateFileInfo();\n      this._updateDownloadBtn();\n      return;\n    }\n\n    for (const entry of files) {\n      const row = dom(\"div\", { classes: [\"av-file-item\"] });\n\n      const cb = dom(\"input\", {\n        attrs: { type: \"checkbox\" },\n        classes: [\"av-file-cb\"],\n      });\n      cb.checked = !!this._fileChecked.get(entry.path);\n      cb.addEventListener(\"change\", () => {\n        this._fileChecked.set(entry.path, cb.checked);\n        row.classList.toggle(\"is-checked\", cb.checked);\n        this._updateFileInfo();\n        this._updateDownloadBtn();\n      });\n\n      const name = dom(\"span\", {\n        classes: [\"av-file-name\"],\n        text: entry.path.split(\"/\").pop() || entry.path,\n        attrs: { title: entry.path },\n      });\n      name.addEventListener(\"click\", () => cb.click());\n\n      const pathEl = dom(\"span\", {\n        classes: [\"av-file-path\"],\n        text: entry.path.includes(\"/\")\n          ? entry.path.slice(0, entry.path.lastIndexOf(\"/\"))\n          : \"\",\n        attrs: { title: entry.path },\n      });\n\n      const size = dom(\"span\", {\n        classes: [\"av-file-size\"],\n        text: entry.size > 0 ? toPrettySize(entry.size) : \"—\",\n      });\n\n      row.classList.toggle(\"is-checked\", !!this._fileChecked.get(entry.path));\n      row.appendChild(cb);\n      row.appendChild(name);\n      row.appendChild(pathEl);\n      row.appendChild(size);\n\n      // Image preview on hover\n      if (isImageEntry(entry.path) && this._imgPopupEl) {\n        const previewUrl = `/api/v1/archive/${this.archiveKey}/file?path=${encodeURIComponent(entry.path)}`;\n        row.addEventListener(\"mouseenter\", () => {\n          this._imgPopupImgEl.src = previewUrl;\n          // Position relative to the modal element (requires position:relative on .modal-archiveviewer)\n          const rowRect = row.getBoundingClientRect();\n          const modalRect = this.el.getBoundingClientRect();\n          const top = Math.max(\n            4,\n            Math.min(rowRect.top - modalRect.top - 60, modalRect.height - 210),\n          );\n          this._imgPopupEl.style.top = `${top}px`;\n          this._imgPopupEl.style.display = \"block\";\n        });\n        row.addEventListener(\"mouseleave\", () => {\n          this._imgPopupEl.style.display = \"none\";\n        });\n      }\n\n      this._fileListEl.appendChild(row);\n    }\n\n    this._updateFileInfo();\n    this._updateDownloadBtn();\n  }\n\n  // ── Selection counters ──────────────────────────────────────────────────────\n\n  _updateFolderInfo() {\n    let checked = 0;\n    for (const [k, v] of this._folderChecked) {\n      if (k !== \"\" && v) checked++;\n    }\n    if (this._folderInfoEl) {\n      this._folderInfoEl.textContent =\n        checked > 0\n          ? `${checked} folder${checked === 1 ? \"\" : \"s\"} selected`\n          : \"\";\n    }\n  }\n\n  _updateFileInfo() {\n    let checked = 0;\n    for (const v of this._fileChecked.values()) {\n      if (v) checked++;\n    }\n    const visible = this._getVisibleFiles().length;\n    if (this._fileInfoEl) {\n      this._fileInfoEl.textContent =\n        `${visible} file${visible === 1 ? \"\" : \"s\"}` +\n        (checked > 0 ? ` · ${checked} selected` : \"\");\n    }\n  }\n\n  _updateDownloadBtn() {\n    if (!this._dlBtn) {\n      return;\n    }\n    const count = this._selectedDownloadFiles().length;\n    this._dlBtn.textContent =\n      count > 0\n        ? `Download ${count} File${count === 1 ? \"\" : \"s\"}`\n        : \"Download Selected\";\n    this._dlBtn.disabled = count === 0;\n  }\n\n  _selectAllFiles(select) {\n    const files = this._getVisibleFiles();\n    for (const f of files) {\n      this._fileChecked.set(f.path, select);\n    }\n    this._renderFiles();\n  }\n\n  _expandAll(expand) {\n    if (!this._tree) {\n      return;\n    }\n    const visit = (node) => {\n      if (node.children.size > 0) {\n        this._folderExpanded.set(node.fullPath, expand);\n      }\n      for (const child of node.children.values()) {\n        visit(child);\n      }\n    };\n    visit(this._tree);\n    this._renderTree();\n  }\n\n  // ── Download logic ──────────────────────────────────────────────────────────\n\n  /**\n   * Returns a list of fake file-like objects for the download batch modal.\n   * Selected files win; if no files are individually checked, use all visible.\n   */\n  _selectedDownloadFiles() {\n    if (!this.archiveKey) {\n      return [];\n    }\n    const visible = this._getVisibleFiles();\n\n    // Prefer per-file checkbox selection\n    const explicitly = visible.filter((f) => this._fileChecked.get(f.path));\n    const targets = explicitly.length > 0 ? explicitly : visible;\n\n    return targets.map((f) => ({\n      key: `archive:${this.archiveKey}:${f.path}`,\n      name: f.path.split(\"/\").pop() || f.path,\n      url: `/api/v1/archive/${this.archiveKey}/file?path=${encodeURIComponent(f.path)}`,\n      size: f.size,\n      expired: false,\n      meta: {},\n    }));\n  }\n\n  // ── Modal lifecycle ─────────────────────────────────────────────────────────\n\n  async onclick(button, e) {\n    nukeEvent(e);\n\n    if (button.cancel || button.id === \"close\") {\n      this._unmount();\n      this.reject(new Error(\"cancelled\"));\n      return;\n    }\n\n    if (button.id === \"download\") {\n      const targets = this._selectedDownloadFiles();\n      if (!targets.length) {\n        return;\n      }\n      // Show download modal inside the archive viewer — don't close the viewer\n      this._showDownloadIn(targets);\n    }\n  }\n\n  // ── Download sub-modal (mounted inside the archive viewer overlay) ──────────\n\n  async _showDownloadIn(targets) {\n    if (this._subHolder || !this._holder) {\n      return;\n    }\n    const title = `Download from ${this.fileInst.name}`;\n    const prefs = registry.files.getDownloadPrefs();\n\n    const modal = new DownloadBatchModal(title, targets.length, {\n      skipExisting: prefs.skipExisting,\n      retries: prefs.maxRetries,\n      concurrent: prefs.maxConcurrent,\n      onOptionsChange: (values) => registry.files.saveDownloadPrefs(values),\n    });\n\n    this._subHolder = dom(\"div\", { classes: [\"av-sub-holder\"] });\n    this._subHolder.appendChild(modal.el);\n    this._holder.appendChild(this._subHolder);\n    modal.onshown();\n\n    const modalDone = modal.promise.catch(() => {});\n\n    // Wait for the user to press Start (or Cancel before starting)\n    let values;\n    try {\n      values = await modal.waitForStart();\n      registry.files.saveDownloadPrefs(values);\n    } catch {\n      modal.cancelRequested = true;\n      await modalDone;\n      this._removeSubHolder();\n      return;\n    }\n\n    const maxRetries = Math.max(0, Math.min(5, Number(values.maxRetries) || 0));\n    const maxConcurrent = Math.max(\n      1,\n      Math.min(4, Number(values.maxConcurrent) || 4),\n    );\n    let done = 0,\n      failed = 0,\n      idx = 0;\n    const total = targets.length;\n\n    const worker = async () => {\n      for (;;) {\n        if (modal.cancelRequested) {\n          return;\n        }\n        const cur = idx++;\n        if (cur >= total) {\n          return;\n        }\n        const file = targets[cur];\n        modal.setCurrent(`Downloading: ${file.name}`);\n\n        if (\n          modal.skipExisting &&\n          registry.files.hasDownloadedFilename(file.name)\n        ) {\n          modal.upsertFileStatus(file.name, \"skipped\", 1, \"existing filename\");\n          modal.update(done, failed, 0);\n          continue;\n        }\n\n        let success = false;\n        let lastErr = null;\n        for (let attempt = 1; attempt <= maxRetries + 1; attempt++) {\n          modal.upsertFileStatus(\n            file.name,\n            attempt === 1 ? \"running\" : \"retrying\",\n            attempt,\n          );\n          try {\n            await registry.files.fetchAndTriggerDownload(file);\n            done++;\n            success = true;\n            registry.files.markFilenameDownloaded(file.name);\n            modal.upsertFileStatus(file.name, \"success\", attempt);\n            break;\n          } catch (ex) {\n            lastErr = ex;\n          }\n        }\n        if (!success) {\n          failed++;\n          modal.upsertFileStatus(\n            file.name,\n            \"failed\",\n            maxRetries + 1,\n            (lastErr && lastErr.message) || \"failed\",\n          );\n        }\n        modal.update(done, failed, 0);\n      }\n    };\n\n    await Promise.all(Array.from({ length: maxConcurrent }, worker));\n\n    if (!modal.cancelRequested) {\n      modal.finish(done, failed, 0, false);\n    }\n\n    // Wait for the user to dismiss the finished download modal, then remove it\n    await modalDone;\n    this._removeSubHolder();\n  }\n\n  _removeSubHolder() {\n    if (this._subHolder && this._subHolder.parentElement) {\n      this._subHolder.parentElement.removeChild(this._subHolder);\n    }\n    this._subHolder = null;\n  }\n}\n"],"names":["IMAGE_EXTS","Set","isImageEntry","filePath","dot","lastIndexOf","has","slice","toLowerCase","collectFiles","node","out","f","files","push","child","children","values","ArchiveModal","constructor","fileInst","dlBtn","id","text","default","super","name","cancel","this","parts","href","split","filter","Boolean","gi","indexOf","archiveKey","length","_tree","_allFiles","_format","_folderChecked","Map","_fileChecked","_folderExpanded","_treeEl","_fileListEl","_folderInfoEl","_fileInfoEl","_dlBtn","btn","_holder","_subHolder","_onKeyDown","_searchQuery","_imgPopupEl","_imgPopupImgEl","_buildUI","_loadListing","mountInto","container","dom","classes","appendChild","el","e","key","stopPropagation","_unmount","reject","Error","document","addEventListener","target","onshown","promise","parentElement","removeChild","removeEventListener","classList","add","layout","sidebar","sidebarHead","_rootCbEl","attrs","type","title","set","checked","_setChildFolders","_syncRootCheckbox","_updateFolderInfo","_renderTree","_renderFiles","rootLabel","click","expandGroup","expandAllBtn","_expandAll","collapseAllBtn","filePanel","fileHead","selectAllBtn","_selectAllFiles","clearSelBtn","searchRow","_searchEl","placeholder","autocomplete","spellcheck","value","trim","alt","body","_statusEl","res","fetch","credentials","ok","json","catch","error","status","data","format","isDir","root","fullPath","entry","path","i","part","get","dirPath","replace","buildTree","_setStatus","ex","message","textContent","toggle","_buildTreeNode","depth","frag","createDocumentFragment","_makeTreeRow","isChecked","isExpanded","hasChildren","size","row","style","paddingLeft","cb","expander","nukeEvent","nowExpanded","icon","label","count","countEl","rootChecked","indeterminate","k","v","_makeFilePanelFolderRow","fileCount","nameEl","_getVisibleFiles","base","result","seen","visit","_hasAnyFolderChecked","q","pop","includes","empty","_updateFileInfo","_updateDownloadBtn","pathEl","toPrettySize","previewUrl","encodeURIComponent","src","rowRect","getBoundingClientRect","modalRect","top","Math","max","min","height","display","visible","_selectedDownloadFiles","disabled","select","expand","explicitly","map","url","expired","meta","onclick","button","targets","_showDownloadIn","prefs","getDownloadPrefs","modal","skipExisting","retries","maxRetries","concurrent","maxConcurrent","onOptionsChange","saveDownloadPrefs","modalDone","waitForStart","cancelRequested","_removeSubHolder","Number","done","failed","idx","total","Promise","all","Array","from","async","cur","file","setCurrent","hasDownloadedFilename","upsertFileStatus","update","success","lastErr","attempt","fetchAndTriggerDownload","markFilenameDownloaded","finish"],"sourceRoot":""}